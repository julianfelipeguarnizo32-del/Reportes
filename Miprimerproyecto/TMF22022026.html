<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Performance (KPIs) TMF ‚Äî 22.02.2026</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600;700&family=Work+Sans:wght@300;400;500;600;700&display=swap');

  :root {
    --bg: #f8fafc;
    --surface: #ffffff;
    --card: #ffffff;
    --border: #e2e8f0;
    --accent: #0891b2;
    --accent2: #06b6d4;
    --green: #059669;
    --red: #dc2626;
    --yellow: #d97706;
    --text: #1e293b;
    --muted: #64748b;
    --header-font: 'Crimson Pro', serif;
    --body-font: 'Work Sans', sans-serif;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { 
    background: var(--bg); 
    color: var(--text); 
    font-family: var(--body-font); 
    font-size: 13px; 
    min-height: 100vh; 
  }

  /* HEADER */
  header {
    background: linear-gradient(135deg, #0891b2 0%, #0e7490 50%, #155e75 100%);
    border-bottom: 1px solid rgba(255,255,255,0.1);
    padding: 28px 32px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 4px 6px rgba(0,0,0,0.05);
  }
  header h1 { 
    font-family: var(--header-font); 
    font-size: 32px; 
    font-weight: 700; 
    color: #ffffff; 
    letter-spacing: -0.5px;
  }
  .header-badge { 
    display: inline-block; 
    background: rgba(255,255,255,0.2); 
    border: 1px solid rgba(255,255,255,0.3); 
    padding: 4px 12px; 
    border-radius: 20px; 
    font-size: 11px; 
    font-weight: 600; 
    margin-left: 12px;
    color: #ffffff;
  }
  header .meta { 
    color: rgba(255,255,255,0.9); 
    font-size: 13px; 
    text-align: right; 
    line-height: 1.8; 
  }
  header .meta span { color: #ffffff; font-weight: 600; }

  /* NAV */
  nav {
    background: var(--surface);
    border-bottom: 2px solid var(--border);
    padding: 0 32px;
    display: flex;
    box-shadow: 0 1px 3px rgba(0,0,0,0.02);
  }
  nav button {
    background: none; 
    border: none; 
    color: var(--muted);
    font-family: var(--body-font); 
    font-size: 13px; 
    font-weight: 600;
    padding: 16px 20px;
    cursor: pointer;
    border-bottom: 3px solid transparent;
    transition: all 0.2s;
    letter-spacing: 0.2px;
  }
  nav button:hover { color: var(--accent); }
  nav button.active {
    color: var(--accent);
    border-bottom-color: var(--accent);
  }

  /* MAIN */
  main { padding: 32px; max-width: 1600px; margin: 0 auto; }

  .tab-panel { display: none; }
  .tab-panel.active { display: block; animation: fadeIn 0.3s ease; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

  /* KPI CARDS */
  .kpi-grid {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 16px;
    margin-bottom: 32px;
  }
  .kpi {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px 22px;
    position: relative;
    overflow: hidden;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    transition: transform 0.2s, box-shadow 0.2s;
  }
  .kpi:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  }
  .kpi::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 3px;
  }
  .kpi.indigo::before { background: linear-gradient(90deg, #6366f1, #8b5cf6); }
  .kpi.green::before { background: linear-gradient(90deg, #059669, #10b981); }
  .kpi.yellow::before { background: linear-gradient(90deg, #d97706, #f59e0b); }
  .kpi.cyan::before { background: linear-gradient(90deg, #0891b2, #06b6d4); }
  .kpi.teal::before { background: linear-gradient(90deg, #0d9488, #14b8a6); }
  .kpi.red::before { background: linear-gradient(90deg, #dc2626, #ef4444); }

  .kpi-label { 
    color: var(--muted); 
    font-size: 11px; 
    font-weight: 600; 
    letter-spacing: 0.5px; 
    text-transform: uppercase; 
    margin-bottom: 10px; 
  }
  .kpi-value { font-size: 24px; font-weight: 700; line-height: 1; margin-bottom: 6px; color: var(--text); }
  .kpi-sub { color: var(--muted); font-size: 11.5px; }
  .kpi-badge { 
    display: inline-block; 
    font-size: 10px; 
    font-weight: 600; 
    padding: 3px 8px; 
    border-radius: 5px; 
    margin-top: 6px; 
  }
  .badge-up { background: rgba(5,150,105,0.12); color: var(--green); }
  .badge-down { background: rgba(220,38,38,0.12); color: var(--red); }

  /* SECTION TITLES */
  .section-title {
    font-family: var(--header-font);
    font-size: 20px;
    font-weight: 600;
    color: var(--text);
    margin-bottom: 18px;
    padding-bottom: 10px;
    border-bottom: 2px solid var(--border);
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .section-title .icon { font-size: 22px; }

  /* ALERTS */
  .alerts { display: flex; flex-direction: column; gap: 12px; margin-bottom: 32px; }
  .alert {
    background: var(--card);
    border: 1px solid var(--border);
    border-left: 4px solid;
    border-radius: 10px;
    padding: 16px 20px;
    display: flex;
    align-items: flex-start;
    gap: 14px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
  }
  .alert-red { border-left-color: var(--red); background: rgba(220,38,38,0.02); }
  .alert-yellow { border-left-color: var(--yellow); background: rgba(217,119,6,0.02); }
  .alert-green { border-left-color: var(--green); background: rgba(5,150,105,0.02); }
  .alert-icon { font-size: 18px; flex-shrink: 0; margin-top: 2px; }
  .alert-title { font-weight: 600; font-size: 13.5px; margin-bottom: 4px; color: var(--text); }
  .alert-body { color: var(--muted); font-size: 12.5px; line-height: 1.6; }
  .alert-stores { display: flex; gap: 6px; flex-wrap: wrap; margin-top: 8px; }
  .store-tag { 
    background: rgba(8,145,178,0.08); 
    border: 1px solid rgba(8,145,178,0.2); 
    border-radius: 5px; 
    padding: 2px 8px; 
    font-size: 11px; 
    font-weight: 600;
    color: var(--accent);
  }

  /* TABLES */
  .table-wrap {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
  }
  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 12.5px;
  }
  thead th {
    background: #f1f5f9;
    color: var(--muted);
    font-weight: 600;
    text-transform: uppercase;
    font-size: 11px;
    letter-spacing: 0.5px;
    padding: 12px 16px;
    text-align: right;
    border-bottom: 2px solid var(--border);
    cursor: pointer;
    white-space: nowrap;
    user-select: none;
    position: relative;
  }
  thead th:first-child { 
    text-align: left;
    position: sticky;
    left: 0;
    background: #f1f5f9;
    z-index: 2;
  }
  thead th:hover { color: var(--accent); }
  tbody tr { transition: background 0.15s; }
  tbody tr:hover { background: rgba(8,145,178,0.04); }
  tbody td {
    padding: 12px 16px;
    border-bottom: 1px solid var(--border);
    text-align: right;
  }
  tbody td:first-child { 
    text-align: left; 
    font-weight: 600;
    position: sticky;
    left: 0;
    background: var(--card);
    z-index: 1;
  }
  tbody tr:hover td:first-child { background: rgba(8,145,178,0.04); }
  tbody tr:last-child td { border-bottom: none; }

  .chip {
    display: inline-block;
    padding: 3px 9px;
    border-radius: 20px;
    font-size: 11px;
    font-weight: 600;
  }
  .chip-green { background: rgba(5,150,105,0.12); color: var(--green); }
  .chip-red { background: rgba(220,38,38,0.12); color: var(--red); }
  .chip-yellow { background: rgba(217,119,6,0.12); color: var(--yellow); }

  /* CHARTS */
  .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
  .chart-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 24px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
  }
  .chart-title {
    font-size: 12px;
    font-weight: 600;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 18px;
  }

  /* HORIZONTAL BARS */
  .hbar { display: flex; flex-direction: column; gap: 8px; }
  .hbar-row { display: flex; align-items: center; gap: 12px; }
  .hbar-label { width: 40px; font-size: 11.5px; font-weight: 600; color: var(--muted); text-align: right; flex-shrink: 0; }
  .hbar-track { 
    flex: 1; 
    height: 20px; 
    background: #f1f5f9; 
    border-radius: 4px; 
    overflow: hidden; 
    position: relative; 
  }
  .hbar-fill { 
    height: 100%; 
    border-radius: 4px; 
    display: flex; 
    align-items: center; 
    padding-left: 8px; 
    font-size: 10.5px; 
    font-weight: 600; 
    transition: width 0.6s ease;
    color: #ffffff;
  }
  .hbar-val { width: 54px; font-size: 11.5px; text-align: right; flex-shrink: 0; font-variant-numeric: tabular-nums; font-weight: 600; }

  /* FILTERS */
  .filter-bar {
    display: flex;
    gap: 12px;
    margin-bottom: 20px;
    align-items: center;
    flex-wrap: wrap;
  }
  .filter-bar input, .filter-bar select {
    background: var(--card);
    border: 1px solid var(--border);
    color: var(--text);
    font-family: var(--body-font);
    font-size: 12.5px;
    padding: 9px 14px;
    border-radius: 8px;
    outline: none;
  }
  .filter-bar input:focus, .filter-bar select:focus { border-color: var(--accent); }
  .filter-btn {
    background: var(--accent);
    color: #fff;
    border: none;
    font-family: var(--body-font);
    font-size: 12.5px;
    font-weight: 600;
    padding: 9px 16px;
    border-radius: 8px;
    cursor: pointer;
    transition: opacity 0.2s;
  }
  .filter-btn:hover { opacity: 0.9; }
  .filter-btn.secondary { 
    background: #f1f5f9; 
    border: 1px solid var(--border); 
    color: var(--muted); 
  }

  /* BAR VIS */
  .bar-wrap { display: flex; align-items: center; gap: 10px; justify-content: flex-end; }
  .bar-track { width: 80px; height: 6px; background: #f1f5f9; border-radius: 3px; overflow: hidden; }
  .bar-fill { height: 100%; border-radius: 3px; }

  .rank-num { color: var(--muted); font-size: 11.5px; font-weight: 700; }
  .rank-1 { color: #d97706; }
  .rank-2 { color: #94a3b8; }
  .rank-3 { color: #b87333; }

  .mt-20 { margin-top: 20px; }

  /* RESPONSIVE */
  @media (max-width: 768px) {
    body { font-size: 12px; }
    
    header {
      flex-direction: column;
      align-items: flex-start;
      gap: 12px;
      padding: 20px;
    }
    header h1 { font-size: 24px; }
    header .meta { text-align: left; font-size: 12px; }

    nav { 
      padding: 0 16px; 
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }
    nav::-webkit-scrollbar { display: none; }
    nav button { 
      padding: 14px 16px; 
      font-size: 12px; 
      white-space: nowrap;
      flex-shrink: 0;
      min-height: 44px;
    }

    main { padding: 20px 16px; }

    .kpi-grid {
      grid-template-columns: 1fr 1fr !important;
      gap: 12px;
    }
    .kpi { padding: 16px 18px; }
    .kpi-label { font-size: 10px; }
    .kpi-value { font-size: 20px; }
    .kpi-sub { font-size: 10.5px; }

    .section-title { font-size: 18px; margin-bottom: 14px; }

    .two-col { 
      grid-template-columns: 1fr !important; 
      gap: 18px; 
    }

    .alerts { gap: 10px; }
    .alert { 
      padding: 12px 16px; 
      flex-direction: column;
      gap: 10px;
    }
    .alert-icon { font-size: 16px; }
    .alert-title { font-size: 12.5px; }
    .alert-body { font-size: 11.5px; }
    .store-tag { font-size: 10px; padding: 2px 7px; }

    .chart-card { padding: 18px; }
    .chart-title { font-size: 10.5px; margin-bottom: 14px; }

    .hbar-label { width: 34px; font-size: 10.5px; }
    .hbar-track { height: 16px; }
    .hbar-fill { font-size: 9.5px; padding-left: 6px; }
    .hbar-val { width: 50px; font-size: 10.5px; }

    .table-wrap { 
      position: relative;
    }
    .table-wrap::after {
      content: '‚Üê Desliza ‚Üí';
      position: absolute;
      bottom: 10px;
      right: 10px;
      background: rgba(8,145,178,0.15);
      color: var(--accent);
      font-size: 9.5px;
      font-weight: 600;
      padding: 4px 10px;
      border-radius: 5px;
      pointer-events: none;
      opacity: 0.8;
      letter-spacing: 0.3px;
      border: 1px solid rgba(8,145,178,0.2);
    }
    table { 
      font-size: 11px;
      min-width: 600px;
    }
    thead th { 
      padding: 10px 12px; 
      font-size: 10px;
    }
    thead th:first-child {
      position: sticky;
      left: 0;
      background: #f1f5f9;
      z-index: 3;
    }
    tbody td { padding: 10px 12px; }
    tbody td:first-child {
      position: sticky;
      left: 0;
      background: var(--card);
      z-index: 2;
      max-width: 60px;
      overflow: hidden;
      text-overflow: ellipsis;
      box-shadow: 2px 0 4px rgba(0,0,0,0.05);
    }

    .chip { font-size: 10px; padding: 2px 7px; }

    .filter-bar { 
      flex-direction: column; 
      align-items: stretch; 
      gap: 10px; 
    }
    .filter-bar input, 
    .filter-bar select,
    .filter-btn { 
      width: 100%; 
      font-size: 12px;
      padding: 12px 14px;
      min-height: 44px;
    }

    .bar-track { width: 60px; }
  }

  @media (max-width: 480px) {
    header h1 { font-size: 20px; }
    .kpi-grid { grid-template-columns: 1fr !important; }
    .kpi-value { font-size: 22px; }
    table { min-width: 500px; }
    nav button { font-size: 11px; padding: 12px 14px; }
  }

  /* Landscape mobile */
  @media (max-width: 900px) and (orientation: landscape) {
    header { padding: 16px 20px; }
    header h1 { font-size: 22px; }
    nav button { padding: 12px 16px; }
    .kpi-grid { 
      grid-template-columns: repeat(3, 1fr) !important;
      gap: 12px;
    }
  }
</style>
</head>
<body>

<header>
  <div>
    <h1>üìä Performance (KPIs) TMF<span class="header-badge">Indicadores TMF</span></h1>
    <div style="color:rgba(255,255,255,0.85);font-size:13px;margin-top:6px;">Indicadores Shopping Tex ¬∑ Corte <span>22 de febrero, 2026</span></div>
  </div>
  <div class="meta">
    <div>15 tiendas activas ¬∑ 7 inactivas</div>
    <div>Datos al <span>22/02/2026</span></div>
    <div style="margin-top:6px;">
      <span>‚óè</span> Sobre meta: 4 &nbsp;
      <span>‚óè</span> Bajo meta: 11
    </div>
  </div>
</header>

<nav>
  <button class="active" onclick="switchTab('resumen')">üìã Resumen Ejecutivo</button>
  <button onclick="switchTab('cumplimiento')">üéØ Cumplimiento</button>
  <button onclick="switchTab('rentabilidad')">üí∞ Rentabilidad</button>
  <button onclick="switchTab('clientes')">üë• Clientes</button>
  <button onclick="switchTab('inventario')">üì¶ Inventario & M¬≤</button>
  <button onclick="switchTab('ranking')">üèÜ Ranking General</button>
</nav>

<main>

<!-- TAB: RESUMEN -->
<div id="tab-resumen" class="tab-panel active">

  <div class="kpi-grid">
    <div class="kpi indigo">
      <div class="kpi-label">Ventas Ejecutadas</div>
      <div class="kpi-value" style="font-size:19px">$1,594M</div>
      <div class="kpi-sub">Corte 22 Feb 2026</div>
    </div>
    <div class="kpi green">
      <div class="kpi-label">Utilidad Total</div>
      <div class="kpi-value" style="font-size:19px">$845M</div>
      <div class="kpi-badge badge-up">Acum 2026</div>
    </div>
    <div class="kpi yellow">
      <div class="kpi-label">Cumplimiento Red</div>
      <div class="kpi-value">93.8%</div>
      <div class="kpi-sub">vs. ppto corte</div>
    </div>
    <div class="kpi cyan">
      <div class="kpi-label">Rent. Total</div>
      <div class="kpi-value">53.0%</div>
      <div class="kpi-badge badge-up">‚ñ≤ vs 44.1% (2025)</div>
    </div>
    <div class="kpi teal">
      <div class="kpi-label">Efectividad Prom</div>
      <div class="kpi-value">63.3%</div>
      <div class="kpi-sub">ing. clientes ‚Üí compra</div>
    </div>
    <div class="kpi red">
      <div class="kpi-label">Bajo Meta</div>
      <div class="kpi-value">10 / 15</div>
      <div class="kpi-sub">67% de la red</div>
    </div>
    <div class="kpi red">
      <div class="kpi-label">Var Vta vs 2025</div>
      <div class="kpi-value">-3.8%</div>
      <div class="kpi-sub">Ca√≠da en ventas</div>
    </div>
    <div class="kpi red">
      <div class="kpi-label">Var Unds vs 2025</div>
      <div class="kpi-value">-11.7%</div>
      <div class="kpi-sub">44,462 unidades</div>
    </div>
    <div class="kpi red">
      <div class="kpi-label">Var Clientes vs 2025</div>
      <div class="kpi-value">-13.2%</div>
      <div class="kpi-sub">20,955 clientes</div>
    </div>
  </div>

  <!-- ALERTS -->
  <div class="section-title"><span class="icon">‚ö†Ô∏è</span> Se√±ales Cr√≠ticas</div>
  <div class="alerts">
    <div class="alert alert-red">
      <div class="alert-icon">üî¥</div>
      <div>
        <div class="alert-title">T22 con cumplimiento cr√≠tico ‚Äî 65.9%</div>
        <div class="alert-body">La tienda T22 est√° 34 puntos por debajo del presupuesto de corte. Presenta la peor efectividad de la red (20.2%) y una ca√≠da catastr√≥fica de clientes (‚àí35.4%). Requiere intervenci√≥n inmediata.</div>
        <div class="alert-stores"><span class="store-tag">T22</span></div>
      </div>
    </div>
    <div class="alert alert-red">
      <div class="alert-icon">üî¥</div>
      <div>
        <div class="alert-title">P√©rdida de utilidad en 3 tiendas</div>
        <div class="alert-body">T22, T08 y T03 presentan variaci√≥n negativa de utilidad 2026 vs 2025. T22 es la m√°s grave: ‚àí33.0% de variaci√≥n (mejor√≥ vs ‚àí37.3%), con efectividad colapsada y p√©rdida masiva de clientes.</div>
        <div class="alert-stores"><span class="store-tag">T22 ‚àí33.0%</span><span class="store-tag">T08 ‚àí12.7%</span><span class="store-tag">T03 ‚àí4.3%</span></div>
      </div>
    </div>
    <div class="alert alert-yellow">
      <div class="alert-icon">üü°</div>
      <div>
        <div class="alert-title">11 tiendas perdiendo clientes compradores (mejora vs 11 previo)</div>
        <div class="alert-body">El 73% de la red registra ca√≠da en clientes que compran vs 2025. T22 lidera la p√©rdida (‚àí35.4%, mejor√≥ vs ‚àí38.6%), seguida de T03 (‚àí17.5%) y T08 (‚àí16.0%). Crisis severa contin√∫a.</div>
        <div class="alert-stores"><span class="store-tag">T22</span><span class="store-tag">T03</span><span class="store-tag">T08</span><span class="store-tag">T19</span><span class="store-tag">T06</span></div>
      </div>
    </div>
    <div class="alert alert-yellow">
      <div class="alert-icon">üü°</div>
      <div>
        <div class="alert-title">T22: Peor efectividad de la red (20.2%)</div>
        <div class="alert-body">Solo 20.2% de clientes que ingresan compran en T22, la peor efectividad de toda la red TMF. Combinado con cumplimiento del 65.9% y p√©rdida del 35.4% de clientes, requiere an√°lisis urgente de causas ra√≠z.</div>
        <div class="alert-stores"><span class="store-tag">T22</span><span class="store-tag">T08 40.5%</span></div>
      </div>
    </div>
    <div class="alert alert-green">
      <div class="alert-icon">üü¢</div>
      <div>
        <div class="alert-title">T18, T13 y T02 lideran con s√≥lido desempe√±o</div>
        <div class="alert-body">T18 lidera con 107.7% de cumplimiento y +29.0% var utilidad. T13 alcanza 106.7% con variaci√≥n de utilidad del +29.8%. T02 completa el top 3 con 106.6% y +23.5% var utilidad.</div>
        <div class="alert-stores"><span class="store-tag">T18 +29%</span><span class="store-tag">T13 +30%</span><span class="store-tag">T02 +24%</span></div>
      </div>
    </div>
    <div class="alert alert-green">
      <div class="alert-icon">üü¢</div>
      <div>
        <div class="alert-title">Rentabilidad 2026 supera significativamente a 2025</div>
        <div class="alert-body">La rentabilidad total pas√≥ de 44.2% en 2025 a 52.8% en 2026, un incremento de +8.6 puntos porcentuales. T19, T02 y T18 lideran con rentabilidades superiores al 55%.</div>
      </div>
    </div>
  </div>

  <!-- Mini charts -->
  <div class="two-col mt-20">
    <div class="chart-card">
      <div class="chart-title">Distribuci√≥n de Cumplimiento</div>
      <div class="hbar" id="hbar-cump"></div>
    </div>
    <div class="chart-card">
      <div class="chart-title">Variaci√≥n Utilidad 2026 vs 2025</div>
      <div class="hbar" id="hbar-util"></div>
    </div>
  </div>

</div>

<!-- TAB: CUMPLIMIENTO -->
<div id="tab-cumplimiento" class="tab-panel">
  <div class="filter-bar">
    <input type="text" id="cump-search" placeholder="üîç Buscar tienda..." oninput="renderCumpTable()">
    <select id="cump-filter" onchange="renderCumpTable()">
      <option value="all">Todas</option>
      <option value="over">Sobre meta ‚â•100%</option>
      <option value="under">Bajo meta <100%</option>
    </select>
    <button class="filter-btn secondary" onclick="document.getElementById('cump-search').value=''; renderCumpTable()">‚úï Limpiar</button>
  </div>
  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th onclick="sortCump('tienda')">Tienda ‚Üï</th>
          <th onclick="sortCump('ejecutado')">Ejecutado ($) ‚Üï</th>
          <th onclick="sortCump('pptoCorte')">Ppto Corte ($) ‚Üï</th>
          <th onclick="sortCump('cump')">Cumplimiento ‚Üï</th>
          <th onclick="sortCump('diferencia')">Diferencia ($) ‚Üï</th>
          <th>Visual</th>
          <th onclick="sortCump('varUtil')">Var Utilidad ‚Üï</th>
        </tr>
      </thead>
      <tbody id="cump-tbody"></tbody>
    </table>
  </div>
</div>

<!-- TAB: RENTABILIDAD -->
<div id="tab-rentabilidad" class="tab-panel">
  <div class="kpi-grid" style="grid-template-columns:repeat(4,1fr)">
    <div class="kpi green">
      <div class="kpi-label">Rent. Total 2026</div>
      <div class="kpi-value">52.8%</div>
      <div class="kpi-badge badge-up">‚ñ≤ +8.6pp vs 2025</div>
    </div>
    <div class="kpi cyan">
      <div class="kpi-label">Mayor Rent. 2026</div>
      <div class="kpi-value">56.4%</div>
      <div class="kpi-sub">T19</div>
    </div>
    <div class="kpi red">
      <div class="kpi-label">Menor Rent. 2026</div>
      <div class="kpi-value">46.6%</div>
      <div class="kpi-sub">T07</div>
    </div>
    <div class="kpi yellow">
      <div class="kpi-label">Mejor Var. Utilidad</div>
      <div class="kpi-value">+31.3%</div>
      <div class="kpi-sub">T13</div>
    </div>
  </div>

  <div class="two-col">
    <div>
      <div class="section-title"><span class="icon">üí∞</span> Rentabilidad 2026 por Tienda</div>
      <div class="chart-card">
        <div class="hbar" id="hbar-rent"></div>
      </div>
    </div>
    <div>
      <div class="section-title"><span class="icon">üìä</span> Detalle Rentabilidad</div>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th onclick="sortRent('tienda')">Tienda ‚Üï</th>
              <th onclick="sortRent('rent2026')">Rent 2026 ‚Üï</th>
              <th onclick="sortRent('rent2025')">Rent 2025 ‚Üï</th>
              <th onclick="sortRent('varRent')">Var (pp) ‚Üï</th>
              <th onclick="sortRent('varUtil')">Var Utilidad ‚Üï</th>
            </tr>
          </thead>
          <tbody id="rent-tbody"></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- TAB: CLIENTES -->
<div id="tab-clientes" class="tab-panel">
  <div class="kpi-grid" style="grid-template-columns:repeat(4,1fr)">
    <div class="kpi cyan">
      <div class="kpi-label">Efectividad Prom</div>
      <div class="kpi-value">63.3%</div>
      <div class="kpi-sub">Clientes que compran / ingresan</div>
    </div>
    <div class="kpi green">
      <div class="kpi-label">Ganando Clientes</div>
      <div class="kpi-value">4</div>
    </div>
    <div class="kpi red">
      <div class="kpi-label">Perdiendo Clientes</div>
      <div class="kpi-value">11</div>
    </div>
    <div class="kpi yellow">
      <div class="kpi-label">Mejor Ticket Promedio</div>
      <div class="kpi-value">$78,466</div>
      <div class="kpi-sub">T01 (2026)</div>
    </div>
  </div>

  <div class="two-col">
    <div>
      <div class="section-title"><span class="icon">üë•</span> Efectividad por Tienda</div>
      <div class="chart-card">
        <div class="hbar" id="hbar-efect"></div>
      </div>
    </div>
    <div>
      <div class="section-title"><span class="icon">üìà</span> Variaci√≥n Clientes 2026 vs 2025</div>
      <div class="chart-card">
        <div class="hbar" id="hbar-clientes"></div>
      </div>
    </div>
  </div>

  <div class="mt-20">
    <div class="section-title"><span class="icon">üìã</span> Detalle Clientes</div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th onclick="sortClientes('tienda')">Tienda ‚Üï</th>
            <th onclick="sortClientes('efectividad')">Efectividad ‚Üï</th>
            <th onclick="sortClientes('varClientes')">Var Clientes ‚Üï</th>
            <th onclick="sortClientes('promCompra2026')">Prom Compra 2026 ‚Üï</th>
            <th onclick="sortClientes('promCompra2025')">Prom Compra 2025 ‚Üï</th>
          </tr>
        </thead>
        <tbody id="clientes-tbody"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- TAB: INVENTARIO -->
<div id="tab-inventario" class="tab-panel">
  <div class="kpi-grid" style="grid-template-columns:repeat(4,1fr)">
    <div class="kpi cyan">
      <div class="kpi-label">Mayor Stock (Unds)</div>
      <div class="kpi-value">31,334</div>
      <div class="kpi-sub">T01</div>
    </div>
    <div class="kpi yellow">
      <div class="kpi-label">Mayor Vta x M¬≤ 2026</div>
      <div class="kpi-value">$138,902</div>
      <div class="kpi-sub">T11</div>
    </div>
    <div class="kpi green">
      <div class="kpi-label">Mayor PxM¬≤ (productividad)</div>
      <div class="kpi-value">57.7</div>
      <div class="kpi-sub">T11 prendas/m¬≤</div>
    </div>
    <div class="kpi red">
      <div class="kpi-label">Menor PxM¬≤</div>
      <div class="kpi-value">28.2</div>
      <div class="kpi-sub">T08</div>
    </div>
  </div>

  <div class="two-col">
    <div>
      <div class="section-title"><span class="icon">üì¶</span> Unidades en Inventario</div>
      <div class="chart-card">
        <div class="hbar" id="hbar-inv"></div>
      </div>
    </div>
    <div>
      <div class="section-title"><span class="icon">üìê</span> Venta por M¬≤</div>
      <div class="chart-card">
        <div class="hbar" id="hbar-vtam2"></div>
      </div>
    </div>
  </div>

  <div class="mt-20">
    <div class="section-title"><span class="icon">üìã</span> Detalle Inventario & Productividad</div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th onclick="sortInv('tienda')">Tienda ‚Üï</th>
            <th onclick="sortInv('undsInv')">Unds Inventario ‚Üï</th>
            <th onclick="sortInv('unds2026')">Unds Vendidas 2026 ‚Üï</th>
            <th onclick="sortInv('varUnds')">Var Unds ‚Üï</th>
            <th onclick="sortInv('pxm2')">PxM¬≤ ‚Üï</th>
            <th onclick="sortInv('vtaM2')">Vta x M¬≤ 2026 ‚Üï</th>
          </tr>
        </thead>
        <tbody id="inv-tbody"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- TAB: RANKING -->
<div id="tab-ranking" class="tab-panel">
  <div class="section-title"><span class="icon">üèÜ</span> Ranking General ‚Äî Todas las M√©tricas</div>
  <div class="filter-bar">
    <select id="rank-sort" onchange="renderRanking()">
      <option value="cump">Ordenar por: Cumplimiento</option>
      <option value="rent2026">Rentabilidad 2026</option>
      <option value="varUtil">Variaci√≥n Utilidad</option>
      <option value="efectividad">Efectividad</option>
      <option value="vtaM2">Venta x M¬≤</option>
      <option value="ejecutado">Ventas Ejecutadas</option>
      <option value="venta2025">Venta 2025 ($)</option>
      <option value="unds2026">Unds 2026</option>
      <option value="clientesCompran2026">Clientes Compran 2026</option>
      <option value="pxm2">PxM¬≤ (Productividad)</option>
      <option value="utilidadM2">Utilidad por M¬≤ 2026</option>
      <option value="promCompra2026">Prom Compra por Cliente 2026</option>
      <option value="undsCliente">Unds por Cliente 2026</option>
      <option value="pvp">PVP</option>
      <option value="pvpInv">PVP Inventario</option>
      <option value="prendasM2">Prendas Vendidas x M¬≤</option>
    </select>
  </div>
  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>Rank</th>
          <th>Tienda</th>
          <th>Ejecutado ($)</th>
          <th>Cump (%)</th>
          <th>Rent 2026</th>
          <th>Var Utilidad</th>
          <th>Efectividad</th>
          <th>Var Clientes</th>
          <th>Vta x M¬≤</th>
          <th>PxM¬≤</th>
          <th>Venta 2025 ($)</th>
          <th>Unds 2026</th>
          <th>Clientes 2026</th>
          <th>Util x M¬≤</th>
          <th>Prom Compra</th>
          <th>PVP</th>
        </tr>
      </thead>
      <tbody id="rank-tbody"></tbody>
    </table>
  </div>
</div>

</main>

<script>
const STORES = [{"tienda": "T01", "ejecutado": 108498767.48, "cump": 0.9508992689290288, "rent2026": 0.5512429611794887, "rent2025": 0.4448694323422723, "varRent": 0.2391117957400477, "utilidad": 59809181.87000003, "varUtil": 0.02966779055160784, "efectividad": 0.7248908296943232, "varClientes": -0.08096885813148791, "vtaM2": 114209.2289263158, "unds2026": 2960.0, "unds2025": 3249.0, "varUnds": -0.08895044629116655, "promCompra2026": 81700.87912650604, "promCompra2025": 75348.15916262976, "undsInv": 32689.0, "pxm2": 34.40947368421052, "pptoCorte": 114101220.8393, "diferencia": -5602453.359299973, "venta2025": 108878089.99, "varVta": -0.003483919584140627, "clientesCompran2026": 1328.0, "utilidadM2": 62957.03354736843, "undsCliente": 2.228915662650603, "pvp": 36654.98901351352, "pvpInv": 38895.44877481722, "prendasM2": 3.11578947368421}, {"tienda": "T02", "ejecutado": 68455815.99000001, "cump": 1.066222618962825, "rent2026": 0.5620270052090284, "rent2025": 0.4155577440135528, "varRent": 0.3524642803689364, "utilidad": 38474017.25000002, "varUtil": 0.235143295296719, "efectividad": 0.6154362416107383, "varClientes": -0.1548387096774193, "vtaM2": 152124.0355333333, "unds2026": 2043.0, "unds2025": 2269.0, "varUnds": -0.09960334949316885, "promCompra2026": 74651.92583424211, "promCompra2025": 56418.27649769585, "undsInv": 19993.0, "pxm2": 44.42888888888889, "pptoCorte": 64204055.3, "diferencia": 4251760.690000013, "venta2025": 61213830.0, "varVta": 0.1183063694919924, "clientesCompran2026": 917.0, "utilidadM2": 85497.81611111115, "undsCliente": 2.227917121046892, "pvp": 33507.49681350955, "pvpInv": 36347.58240384134, "prendasM2": 4.54}, {"tienda": "T03", "ejecutado": 85714531.5, "cump": 0.8415277053587884, "rent2026": 0.5497569948218175, "rent2025": 0.4367889092738656, "varRent": 0.2586331363947731, "utilidad": 47122163.25000001, "varUtil": -0.04316855125733188, "efectividad": 0.8270787343635025, "varClientes": -0.1747430249632893, "vtaM2": 119880.4636363636, "unds2026": 2382.0, "unds2025": 2902.0, "varUnds": -0.1791867677463818, "promCompra2026": 76258.47998220641, "promCompra2025": 68650.82231277534, "undsInv": 32052.0, "pxm2": 44.82797202797203, "pptoCorte": 101855863.989, "diferencia": -16141332.48899999, "venta2025": 93502419.99000001, "varVta": -0.08329076927455903, "clientesCompran2026": 1124.0, "utilidadM2": 65905.12342657344, "undsCliente": 2.119217081850534, "pvp": 35984.2701511335, "pvpInv": 37751.42343691501, "prendasM2": 3.331468531468531}, {"tienda": "T04", "ejecutado": 159399889.0, "cump": 0.9514739831224227, "rent2026": 0.4856354426319585, "rent2025": 0.4151828955898621, "varRent": 0.1696903889597918, "utilidad": 77410235.65000005, "varUtil": 0.0309859576885001, "efectividad": 0.7072100313479623, "varClientes": -0.06583850931677016, "vtaM2": 221388.7347222222, "unds2026": 4752.0, "unds2025": 5043.0, "varUnds": -0.05770374776918496, "promCompra2026": 70655.97916666667, "promCompra2025": 61135.96824016565, "undsInv": 35032.0, "pxm2": 48.65555555555556, "pptoCorte": 167529424.6899976, "diferencia": -8129535.689997643, "venta2025": 147643363.3, "varVta": 0.07962786431593027, "clientesCompran2026": 2256.0, "utilidadM2": 107514.2161805556, "undsCliente": 2.106382978723404, "pvp": 33543.74768518519, "pvpInv": 44197.8318680064, "prendasM2": 6.6}, {"tienda": "T05", "ejecutado": 132179339.13, "cump": 1.06276429330259, "rent2026": 0.5166156487046736, "rent2025": 0.4619929861541543, "varRent": 0.1182326662688624, "utilidad": 68285915.02999999, "varUtil": 0.1506571749730252, "efectividad": 0.4556896994605703, "varClientes": 0.08634415186772815, "vtaM2": 308830.2316121495, "unds2026": 3560.0, "unds2025": 2971.0, "varUnds": 0.1982497475597442, "promCompra2026": 74509.21033258173, "promCompra2025": 66329.97679118186, "undsInv": 34445.0, "pxm2": 80.47897196261682, "pptoCorte": 124373146.4850465, "diferencia": 7806192.644953474, "venta2025": 108316852.1, "varVta": 0.2203026266676376, "clientesCompran2026": 1774.0, "utilidadM2": 159546.5304439252, "undsCliente": 2.006764374295378, "pvp": 37129.02784550561, "pvpInv": 41426.53502685441, "prendasM2": 8.317757009345796}, {"tienda": "T06", "ejecutado": 156316911.0, "cump": 0.9443330178869281, "rent2026": 0.5255909939264345, "rent2025": 0.4484537061787353, "varRent": 0.172007247760275, "utilidad": 82158760.62, "varUtil": -0.01137447050413543, "efectividad": 0.6766864732610977, "varClientes": -0.06337687469762943, "vtaM2": 217106.8208333333, "unds2026": 4416.0, "unds2025": 4487.0, "varUnds": -0.01582349008246042, "promCompra2026": 80742.20609504133, "promCompra2025": 74938.71794871795, "undsInv": 33980.0, "pxm2": 47.19444444444444, "pptoCorte": 165531553.0, "diferencia": -9214642.0, "venta2025": 154898330.0, "varVta": 0.009158142634591249, "clientesCompran2026": 1936.0, "utilidadM2": 114109.38975, "undsCliente": 2.28099173553719, "pvp": 35397.85122282609, "pvpInv": 39523.34917598587, "prendasM2": 6.133333333333333}, {"tienda": "T07", "ejecutado": 102019566.6, "cump": 0.9571705895407866, "rent2026": 0.5374955664632279, "rent2025": 0.4476869503244766, "varRent": 0.200605838686295, "utilidad": 54835064.74, "varUtil": 0.04381797064032389, "efectividad": 0.8125770653514182, "varClientes": -0.07832167832167836, "vtaM2": 167245.191147541, "unds2026": 2701.0, "unds2025": 2892.0, "varUnds": -0.0660442600276625, "promCompra2026": 77404.83050075872, "promCompra2025": 68555.78881118882, "undsInv": 36292.0, "pxm2": 59.49508196721312, "pptoCorte": 106584518.7, "diferencia": -4564952.100000009, "venta2025": 98034778.0, "varVta": 0.0406466835677437, "clientesCompran2026": 1318.0, "utilidadM2": 89893.54875409836, "undsCliente": 2.049317147192716, "pvp": 37771.03539429841, "pvpInv": 35844.15262316764, "prendasM2": 4.427868852459016}, {"tienda": "T08", "ejecutado": 172181557.0, "cump": 0.894002390128928, "rent2026": 0.4857239884873384, "rent2025": 0.4217246294522656, "varRent": 0.1517562754591661, "utilidad": 83632712.61000001, "varUtil": -0.1273492827624749, "efectividad": 0.4050220433199156, "varClientes": -0.1598409542743539, "vtaM2": 162435.4311320755, "unds2026": 4842.0, "unds2025": 5477.0, "varUnds": -0.1159393828738361, "promCompra2026": 81486.77567439659, "promCompra2025": 74130.43339960239, "undsInv": 55641.0, "pxm2": 52.49150943396226, "pptoCorte": 192596305.0, "diferencia": -20414748.0, "venta2025": 186438040.0, "varVta": -0.07646767258441467, "clientesCompran2026": 2113.0, "utilidadM2": 78898.78548113209, "undsCliente": 2.291528632276384, "pvp": 35560.00764147047, "pvpInv": 39806.70239571539, "prendasM2": 4.567924528301886}, {"tienda": "T09", "ejecutado": 82599668.0, "cump": 0.8970441803039334, "rent2026": 0.5462963704648306, "rent2025": 0.4397547405487906, "varRent": 0.2422751140398889, "utilidad": 45123898.83000001, "varUtil": 0.07182572723911629, "efectividad": 0.7301587301587301, "varClientes": -0.04625199362041466, "vtaM2": 137666.1133333333, "unds2026": 2311.0, "unds2025": 2589.0, "varUnds": -0.1073773657782928, "promCompra2026": 69063.26755852843, "promCompra2025": 63440.66985645932, "undsInv": 27220.0, "pxm2": 45.36666666666667, "pptoCorte": 92079821.5, "diferencia": -9480153.5, "venta2025": 79554600.0, "varVta": 0.03827645415852765, "clientesCompran2026": 1196.0, "utilidadM2": 75206.49805000002, "undsCliente": 1.932274247491639, "pvp": 35741.95932496755, "pvpInv": 39856.5412196914, "prendasM2": 3.851666666666667}, {"tienda": "T10", "ejecutado": 95858887.15, "cump": 1.011583175157795, "rent2026": 0.5317442829295356, "rent2025": 0.4621136239429554, "varRent": 0.150678654293853, "utilidad": 50972415.21000003, "varUtil": 0.06865271951211227, "efectividad": 0.6868894601542417, "varClientes": 0.05863708399366097, "vtaM2": 163581.7186860068, "unds2026": 2827.0, "unds2025": 2537.0, "varUnds": 0.1143082380764682, "promCompra2026": 71750.66403443115, "promCompra2025": 68971.51347068146, "undsInv": 27254.0, "pxm2": 46.50853242320819, "pptoCorte": 94761250.9817071, "diferencia": 1097636.16829291, "venta2025": 87042050.0, "varVta": 0.1012939969819187, "clientesCompran2026": 1336.0, "utilidadM2": 86983.64370307172, "undsCliente": 2.116017964071856, "pvp": 33908.34352670676, "pvpInv": 40037.07815366552, "prendasM2": 4.824232081911263}, {"tienda": "T11", "ejecutado": 112016369.0, "cump": 0.9221031058672857, "rent2026": 0.5582068476081385, "rent2025": 0.4378070372703493, "varRent": 0.2750065670219948, "utilidad": 62528304.22, "varUtil": 0.09926513358214151, "efectividad": 0.5825339067151836, "varClientes": -0.04189336235038088, "vtaM2": 277268.2400990099, "unds2026": 3225.0, "unds2025": 3494.0, "varUnds": -0.07698912421293647, "promCompra2026": 63609.52243043725, "promCompra2025": 58661.99945048966, "undsInv": 24157.0, "pxm2": 59.79455445544554, "pptoCorte": 121479223.188, "diferencia": -9462854.188000008, "venta2025": 107820754.99, "varVta": 0.03891286061193977, "clientesCompran2026": 1761.0, "utilidadM2": 154773.0302475248, "undsCliente": 1.831345826235094, "pvp": 34733.75782945737, "pvpInv": 40147.46023926812, "prendasM2": 7.982673267326732}, {"tienda": "T13", "ejecutado": 67953522.5, "cump": 1.067084503320127, "rent2026": 0.518120343798219, "rent2025": 0.3986353740550599, "varRent": 0.2997349897168327, "utilidad": 35208102.44000001, "varUtil": 0.2980900788517873, "efectividad": 0.6542586750788644, "varClientes": 0.0668724279835391, "vtaM2": 145199.8344017094, "unds2026": 1981.0, "unds2025": 1870.0, "varUnds": 0.05935828877005345, "promCompra2026": 65528.9513018322, "promCompra2025": 56413.17689300411, "undsInv": 29216.0, "pxm2": 62.42735042735043, "pptoCorte": 63681481.91503988, "diferencia": 4272040.58496011, "venta2025": 54833607.94, "varVta": 0.2392677602822719, "clientesCompran2026": 1037.0, "utilidadM2": 75230.98811965814, "undsCliente": 1.910318225650916, "pvp": 34302.63629480061, "pvpInv": 37760.58912924425, "prendasM2": 4.232905982905983}, {"tienda": "T18", "ejecutado": 93017580.0, "cump": 1.077344856567177, "rent2026": 0.556286427468872, "rent2025": 0.4708819650214708, "varRent": 0.1813712751634202, "utilidad": 51744417.27, "varUtil": 0.2900544839661386, "efectividad": 0.9024390243902439, "varClientes": 0.1495972382048332, "vtaM2": 175504.8679245283, "unds2026": 2364.0, "unds2025": 2099.0, "varUnds": 0.1262505955216771, "promCompra2026": 93110.6906906907, "promCompra2025": 83112.3072497123, "undsInv": 24470.0, "pxm2": 46.16981132075472, "pptoCorte": 86339652.0, "diferencia": 6677928.0, "venta2025": 72224595.0, "varVta": 0.2878934108249414, "clientesCompran2026": 999.0, "utilidadM2": 97630.97598113208, "undsCliente": 2.366366366366366, "pvp": 39347.538071066, "pvpInv": 40255.79746628525, "prendasM2": 4.460377358490565}, {"tienda": "T19", "ejecutado": 91803494.0, "cump": 0.8813122374806889, "rent2026": 0.5635578448680831, "rent2025": 0.4573122444854371, "varRent": 0.2323261659048568, "utilidad": 51736579.23, "varUtil": 0.02162956143428341, "efectividad": 0.5191754554170661, "varClientes": -0.113747954173486, "vtaM2": 204007.7644444444, "unds2026": 2406.0, "unds2025": 2652.0, "varUnds": -0.09276018099547512, "promCompra2026": 84767.76915974145, "promCompra2025": 76185.63829787234, "undsInv": 24596.0, "pxm2": 54.65777777777778, "pptoCorte": 104166820.9015554, "diferencia": -12363326.90155542, "venta2025": 93098850.0, "varVta": -0.01391377014861084, "clientesCompran2026": 1083.0, "utilidadM2": 114970.1760666667, "undsCliente": 2.221606648199446, "pvp": 38156.06566916043, "pvpInv": 41214.82883395674, "prendasM2": 5.346666666666667}, {"tienda": "T22", "ejecutado": 65654553.5, "cump": 0.6593298486878671, "rent2026": 0.5505212231776125, "rent2025": 0.463862058928265, "varRent": 0.1868209796023632, "utilidad": 36144225.1, "varUtil": -0.3303519930320817, "efectividad": 0.2018706157443492, "varClientes": -0.3541147132169576, "vtaM2": 86959.67350993378, "unds2026": 1692.0, "unds2025": 2647.0, "varUnds": -0.3607857952398942, "promCompra2026": 84497.49485199485, "promCompra2025": 81657.16541147133, "undsInv": 38911.0, "pxm2": 51.53774834437086, "pptoCorte": 99577705.5, "diferencia": -33923152.0, "venta2025": 98233569.99000001, "varVta": -0.331648503595222, "clientesCompran2026": 777.0, "utilidadM2": 47873.14582781457, "undsCliente": 2.177606177606178, "pvp": 38802.92760047281, "pvpInv": 38366.72578448254, "prendasM2": 2.241059602649007}];

const STORES_MAP = {};
STORES.forEach(s => STORES_MAP[s.tienda] = s);

// ---- UTILITIES ----
const fmt = (n, dec=1) => isNaN(n) ? '‚Äî' : (n * 100).toFixed(dec) + '%';
const fmtM = (n) => {
  if (isNaN(n) || n === 0) return '‚Äî';
  if (n >= 1e9) return '$' + (n/1e9).toFixed(2) + 'B';
  if (n >= 1e6) return '$' + (n/1e6).toFixed(1) + 'M';
  return '$' + n.toLocaleString('es-CO', {maximumFractionDigits: 0});
};
const fmtN = (n) => isNaN(n) || n===0 ? '‚Äî' : n.toLocaleString('es-CO', {maximumFractionDigits: 0});
const chip = (v, t='%', threshold=0) => {
  const cls = v > threshold ? 'chip-green' : v < threshold ? 'chip-red' : 'chip-yellow';
  const sign = v > 0 ? '+' : '';
  const val = t === '%' ? sign + (v*100).toFixed(1) + '%' : sign + v.toFixed(1);
  return `<span class="chip ${cls}">${val}</span>`;
};
const chipCump = (v) => {
  const cls = v >= 1 ? 'chip-green' : v >= 0.9 ? 'chip-yellow' : 'chip-red';
  return `<span class="chip ${cls}">${(v*100).toFixed(1)}%</span>`;
};

// ---- TAB SWITCHING ----
function switchTab(id) {
  document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
  document.getElementById('tab-' + id).classList.add('active');
  event.target.classList.add('active');
  renderTab(id);
}

function renderTab(id) {
  if (id === 'resumen') { renderHbarCump(); renderHbarUtil(); }
  if (id === 'cumplimiento') renderCumpTable();
  if (id === 'rentabilidad') { renderHbarRent(); renderRentTable(); }
  if (id === 'clientes') { renderHbarEfect(); renderHbarClientes(); renderClientesTable(); }
  if (id === 'inventario') { renderHbarInv(); renderHbarVtaM2(); renderInvTable(); }
  if (id === 'ranking') renderRanking();
}

// ---- HBAR ----
function makeHbar(containerId, data, colorFn, labelFn, maxVal) {
  const el = document.getElementById(containerId);
  if (!el) return;
  const max = maxVal || Math.max(...data.map(d => Math.abs(d.value)));
  el.innerHTML = data.map(d => {
    const pct = Math.min(Math.abs(d.value) / max * 100, 100);
    const color = colorFn(d.value);
    const label = labelFn(d.value);
    return `<div class="hbar-row">
      <div class="hbar-label">${d.label}</div>
      <div class="hbar-track">
        <div class="hbar-fill" style="width:${pct}%;background:${color}" title="${d.label}: ${label}">${pct > 15 ? label : ''}</div>
      </div>
      <div class="hbar-val" style="color:${color}">${label}</div>
    </div>`;
  }).join('');
}

function renderHbarCump() {
  const data = [...STORES].sort((a,b) => b.cump - a.cump).map(s => ({
    label: s.tienda,
    value: s.cump
  }));
  makeHbar('hbar-cump', data,
    v => v >= 1 ? '#059669' : v >= 0.9 ? '#d97706' : '#dc2626',
    v => (v*100).toFixed(1) + '%',
    1.15
  );
}

function renderHbarUtil() {
  const data = [...STORES].filter(s => s.varUtil !== 0).sort((a,b) => b.varUtil - a.varUtil).map(s => ({
    label: s.tienda,
    value: s.varUtil
  }));
  makeHbar('hbar-util', data,
    v => v >= 0 ? '#059669' : '#dc2626',
    v => (v >= 0 ? '+' : '') + (v*100).toFixed(1) + '%',
    null
  );
}

function renderHbarRent() {
  const data = [...STORES].sort((a,b) => b.rent2026 - a.rent2026).map(s => ({
    label: s.tienda,
    value: s.rent2026
  }));
  makeHbar('hbar-rent', data,
    v => v >= 0.55 ? '#059669' : v >= 0.50 ? '#0891b2' : '#d97706',
    v => (v*100).toFixed(1) + '%',
    0.6
  );
}

function renderHbarEfect() {
  const data = [...STORES].sort((a,b) => b.efectividad - a.efectividad).map(s => ({
    label: s.tienda,
    value: s.efectividad
  }));
  makeHbar('hbar-efect', data,
    v => v >= 0.8 ? '#059669' : v >= 0.5 ? '#0891b2' : '#dc2626',
    v => (v*100).toFixed(1) + '%',
    1.05
  );
}

function renderHbarClientes() {
  const data = [...STORES].filter(s => s.varClientes !== 0).sort((a,b) => b.varClientes - a.varClientes).map(s => ({
    label: s.tienda,
    value: s.varClientes
  }));
  makeHbar('hbar-clientes', data,
    v => v >= 0 ? '#059669' : '#dc2626',
    v => (v >= 0 ? '+' : '') + (v*100).toFixed(1) + '%',
    null
  );
}

function renderHbarInv() {
  const data = [...STORES].filter(s => s.undsInv > 0).sort((a,b) => b.undsInv - a.undsInv).map(s => ({
    label: s.tienda,
    value: s.undsInv
  }));
  makeHbar('hbar-inv', data,
    v => '#0891b2',
    v => v.toLocaleString('es-CO'),
    null
  );
}

function renderHbarVtaM2() {
  const data = [...STORES].filter(s => s.vtaM2 > 0).sort((a,b) => b.vtaM2 - a.vtaM2).map(s => ({
    label: s.tienda,
    value: s.vtaM2
  }));
  makeHbar('hbar-vtam2', data,
    v => '#06b6d4',
    v => '$' + (v/1000).toFixed(0) + 'K',
    null
  );
}

// ---- SORT STATE ----
let cumpSortKey = 'cump', cumpSortDir = -1;
let rentSortKey = 'rent2026', rentSortDir = -1;
let clientesSortKey = 'efectividad', clientesSortDir = -1;
let invSortKey = 'undsInv', invSortDir = -1;

function sortCump(key) { cumpSortKey = key; cumpSortDir *= -1; renderCumpTable(); }
function sortRent(key) { rentSortKey = key; rentSortDir *= -1; renderRentTable(); }
function sortClientes(key) { clientesSortKey = key; clientesSortDir *= -1; renderClientesTable(); }
function sortInv(key) { invSortKey = key; invSortDir *= -1; renderInvTable(); }

function renderCumpTable() {
  const search = document.getElementById('cump-search').value.toLowerCase();
  const filter = document.getElementById('cump-filter').value;
  let rows = [...STORES];
  if (search) rows = rows.filter(r => r.tienda.toLowerCase().includes(search));
  if (filter === 'over') rows = rows.filter(r => r.cump >= 1);
  if (filter === 'under') rows = rows.filter(r => r.cump < 1);
  rows.sort((a,b) => {
    const av = a[cumpSortKey] || 0, bv = b[cumpSortKey] || 0;
    return cumpSortDir * (typeof av === 'string' ? av.localeCompare(bv) : bv - av);
  });
  document.getElementById('cump-tbody').innerHTML = rows.map(r => {
    const pct = Math.min(r.cump * 100, 130);
    const color = r.cump >= 1 ? '#059669' : r.cump >= 0.9 ? '#d97706' : '#dc2626';
    return `<tr>
      <td>${r.tienda}</td>
      <td>${fmtM(r.ejecutado)}</td>
      <td>${fmtM(r.pptoCorte)}</td>
      <td>${chipCump(r.cump)}</td>
      <td style="color:${r.diferencia>=0?'#059669':'#dc2626'}">${r.diferencia>=0?'+':''}${fmtM(Math.abs(r.diferencia))}</td>
      <td>
        <div class="bar-wrap">
          <div class="bar-track">
            <div class="bar-fill" style="width:${Math.min(pct/130*100,100)}%;background:${color}"></div>
          </div>
        </div>
      </td>
      <td>${chip(r.varUtil)}</td>
    </tr>`;
  }).join('');
}

function renderRentTable() {
  let rows = [...STORES].sort((a,b) => {
    const av = a[rentSortKey]||0, bv = b[rentSortKey]||0;
    return rentSortDir * (bv - av);
  });
  document.getElementById('rent-tbody').innerHTML = rows.map(r => `<tr>
    <td>${r.tienda}</td>
    <td>${fmt(r.rent2026)}</td>
    <td>${fmt(r.rent2025)}</td>
    <td>${r.varRent > 0 ? chip(r.varRent) : '<span class="chip chip-red">‚Äî</span>'}</td>
    <td>${r.varUtil !== 0 ? chip(r.varUtil) : '‚Äî'}</td>
  </tr>`).join('');
}

function renderClientesTable() {
  let rows = [...STORES].sort((a,b) => {
    const av = a[clientesSortKey]||0, bv = b[clientesSortKey]||0;
    return clientesSortDir * (bv - av);
  });
  document.getElementById('clientes-tbody').innerHTML = rows.map(r => `<tr>
    <td>${r.tienda}</td>
    <td>${fmt(r.efectividad)}</td>
    <td>${r.varClientes !== 0 ? chip(r.varClientes) : '‚Äî'}</td>
    <td>${r.promCompra2026 > 0 ? fmtM(r.promCompra2026) : '‚Äî'}</td>
    <td>${r.promCompra2025 > 0 ? fmtM(r.promCompra2025) : '‚Äî'}</td>
  </tr>`).join('');
}

function renderInvTable() {
  let rows = [...STORES].sort((a,b) => {
    const av = a[invSortKey]||0, bv = b[invSortKey]||0;
    return invSortDir * (bv - av);
  });
  document.getElementById('inv-tbody').innerHTML = rows.map(r => `<tr>
    <td>${r.tienda}</td>
    <td>${r.undsInv > 0 ? fmtN(r.undsInv) : '‚Äî'}</td>
    <td>${fmtN(r.unds2026)}</td>
    <td>${chip(r.varUnds)}</td>
    <td>${r.pxm2 > 0 ? r.pxm2.toFixed(1) : '‚Äî'}</td>
    <td>${r.vtaM2 > 0 ? fmtM(r.vtaM2) : '‚Äî'}</td>
  </tr>`).join('');
}

function renderRanking() {
  const sortKey = document.getElementById('rank-sort').value;
  let rows = [...STORES].sort((a,b) => (b[sortKey]||0) - (a[sortKey]||0));
  document.getElementById('rank-tbody').innerHTML = rows.map((r, i) => {
    const rank = i + 1;
    const rankStyle = rank === 1 ? 'rank-1' : rank === 2 ? 'rank-2' : rank === 3 ? 'rank-3' : '';
    return `<tr>
      <td><span class="rank-num ${rankStyle}">#${rank}</span></td>
      <td><b>${r.tienda}</b></td>
      <td>${fmtM(r.ejecutado)}</td>
      <td>${chipCump(r.cump)}</td>
      <td>${fmt(r.rent2026)}</td>
      <td>${r.varUtil !== 0 ? chip(r.varUtil) : '‚Äî'}</td>
      <td>${fmt(r.efectividad)}</td>
      <td>${r.varClientes !== 0 ? chip(r.varClientes) : '‚Äî'}</td>
      <td>${r.vtaM2 > 0 ? fmtM(r.vtaM2) : '‚Äî'}</td>
      <td>${r.pxm2 > 0 ? r.pxm2.toFixed(1) : '‚Äî'}</td>
      <td>${r.venta2025 > 0 ? fmtM(r.venta2025) : '‚Äî'}</td>
      <td>${r.unds2026 > 0 ? fmtN(r.unds2026) : '‚Äî'}</td>
      <td>${r.clientesCompran2026 > 0 ? fmtN(r.clientesCompran2026) : '‚Äî'}</td>
      <td>${r.utilidadM2 > 0 ? fmtM(r.utilidadM2) : '‚Äî'}</td>
      <td>${r.promCompra2026 > 0 ? fmtM(r.promCompra2026) : '‚Äî'}</td>
      <td>${r.pvp > 0 ? fmtM(r.pvp) : '‚Äî'}</td>
    </tr>`;
  }).join('');
}

// ---- INIT ----
renderHbarCump();
renderHbarUtil();
</script>
</body>
</html>